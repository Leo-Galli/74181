name: 74181 Workbench

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential valgrind linux-tools-common linux-tools-generic

    - name: Compile 74181.c
      run: |
        gcc -Wall -O2 74181.c -o 74181

    - name: Run program (show output in logs)
      run: |
        ./74181 || true

    - name: Memory check (Valgrind)
      run: |
        valgrind --leak-check=full ./74181 > valgrind.log 2>&1 || true

    - name: CPU/Performance stats (perf)
      run: |
        perf stat ./74181 > perf.log 2>&1 || true

    - name: Time and resource usage
      run: |
        /usr/bin/time -v ./74181 > time.log 2>&1 || true

    - name: Save logs as artifact
      uses: actions/upload-artifact@v4
      with:
        name: profiling-results
        path: |
          valgrind.log
          perf.log
          time.log
